<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Twitch Authentication</title>
  <style>
    body {
      font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
      background-color: #0e0e10;
      color: #efeff1;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    .auth-container {
      background-color: #18181b;
      border-radius: 8px;
      padding: 2rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      max-width: 90%;
      width: 400px;
    }
    .success {
      color: #00fa7c;
    }
    .error {
      color: #f14669;
    }
    .logo {
      margin-bottom: 1.5rem;
    }
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #9146ff;
      animation: spin 1s ease-in-out infinite;
      margin-right: 0.5rem;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="auth-container">
    <div class="logo">
      <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9.41 33.9L3.3 27.79V5.5H32.11V21.79L25.36 28.54H19.14L14.57 33.11H9.41V33.9Z" fill="#9146FF"/>
        <path d="M7.94 9.99H11.03V19.21H7.94V9.99Z" fill="white"/>
        <path d="M19.05 9.99H22.14V19.21H19.05V9.99Z" fill="white"/>
        <path d="M7.94 9.99H11.03V19.21H7.94V9.99Z" fill="white"/>
        <path d="M19.05 9.99H22.14V19.21H19.05V9.99Z" fill="white"/>
      </svg>
    </div>
    <h2>Twitch Authentication</h2>
    <div id="status">
      <div class="spinner"></div>
      <span>Processing authentication...</span>
    </div>
    
    <script>
      // Extract the access token from the URL hash
      function extractHashParams() {
        const hashParams = {};
        const hash = window.location.hash.substring(1);
        
        if (hash) {
          const params = hash.split('&');
          
          for (let i = 0; i < params.length; i++) {
            const keyValue = params[i].split('=');
            hashParams[keyValue[0]] = decodeURIComponent(keyValue[1]);
          }
        }
        
        return hashParams;
      }

      // Handle the authentication process
      function handleAuthentication() {
        const statusElement = document.getElementById('status');
        const params = extractHashParams();
        
        if (params.access_token) {
          statusElement.innerHTML = '<p class="success">Authentication successful!</p><p>You can close this window now.</p>';
          
          // Send the token back to the parent window
          if (window.opener && !window.opener.closed) {
            window.opener.postMessage({
              type: 'TWITCH_AUTH',
              token: params.access_token,
              state: params.state || ''
            }, window.location.origin);
            
            // Close this window after a short delay
            setTimeout(() => window.close(), 1500);
          } else {
            statusElement.innerHTML = '<p class="error">Error: Could not communicate with the main window.</p><p>Please close this window and try again.</p>';
          }
        } else if (params.error) {
          statusElement.innerHTML = `<p class="error">Authentication error: ${params.error}</p><p>Please close this window and try again.</p>`;
        } else {
          statusElement.innerHTML = '<p class="error">No authentication data found.</p><p>Please close this window and try again.</p>';
        }
      }

      // Run when the page loads
      document.addEventListener('DOMContentLoaded', handleAuthentication);
    </script>
  </div>
</body>
</html>